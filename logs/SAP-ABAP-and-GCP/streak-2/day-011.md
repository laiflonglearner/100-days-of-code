Day 011 - 2025/08/06

## What I did today:

✅ Defined `Products`, `Suppliers`, and `Stock` entities with associations in `schema.cds ⟶ It's done and I believe I've followed the best practice. But I'm still trying to understand how it actually works, I know how database entities work but in SAP it looks different? So here's the generated SQL of the  using `cds compile`:

```sql
CREATE TABLE com_nadsportfolio_inventory_Products (
  createdAt TIMESTAMP_TEXT,
  createdBy NVARCHAR(255),
  modifiedAt TIMESTAMP_TEXT,
  modifiedBy NVARCHAR(255),
  ID INTEGER NOT NULL,
  name NVARCHAR(100),
  description NVARCHAR(1000),
  supplier_ID INTEGER,
  price DECIMAL(10, 2),
  currency_code NVARCHAR(3),
  PRIMARY KEY(ID)
);

CREATE TABLE com_nadsportfolio_inventory_Suppliers (
  createdAt TIMESTAMP_TEXT,
  createdBy NVARCHAR(255),
  modifiedAt TIMESTAMP_TEXT,
  modifiedBy NVARCHAR(255),
  ID INTEGER NOT NULL,
  name NVARCHAR(100),
  email NVARCHAR(100),
  phone NVARCHAR(25),
  address NVARCHAR(255),
  PRIMARY KEY(ID)
);

CREATE TABLE com_nadsportfolio_inventory_Stock (
  createdAt TIMESTAMP_TEXT,
  createdBy NVARCHAR(255),
  modifiedAt TIMESTAMP_TEXT,
  modifiedBy NVARCHAR(255),
  ID INTEGER NOT NULL,
  product_ID INTEGER,
  quantity INTEGER,
  lastUpdated TIMESTAMP_TEXT,
  PRIMARY KEY(ID)
);

CREATE TABLE sap_common_Currencies (
  name NVARCHAR(255),
  descr NVARCHAR(1000),
  code NVARCHAR(3) NOT NULL,
  symbol NVARCHAR(5),
  minorUnit SMALLINT,
  PRIMARY KEY(code)
);

CREATE TABLE com_nadsportfolio_inventory_Products_texts (
  locale NVARCHAR(14) NOT NULL,
  ID INTEGER NOT NULL,
  name NVARCHAR(100),
  description NVARCHAR(1000),
  PRIMARY KEY(locale, ID)
);

CREATE TABLE sap_common_Currencies_texts (
  locale NVARCHAR(14) NOT NULL,
  name NVARCHAR(255),
  descr NVARCHAR(1000),
  code NVARCHAR(3) NOT NULL,
  PRIMARY KEY(locale, code)
);

CREATE VIEW localized_com_nadsportfolio_inventory_Products AS SELECT
  L_0.createdAt,
  L_0.createdBy,
  L_0.modifiedAt,
  L_0.modifiedBy,
  L_0.ID,
  coalesce(localized_1.name, L_0.name) AS name,
  coalesce(localized_1.description, L_0.description) AS description,
  L_0.supplier_ID,
  L_0.price,
  L_0.currency_code
FROM (com_nadsportfolio_inventory_Products AS L_0 LEFT JOIN com_nadsportfolio_inventory_Products_texts AS localized_1 ON localized_1.ID = L_0.ID AND localized_1.locale = session_context( '$user.locale' ));

CREATE VIEW localized_sap_common_Currencies AS SELECT
  coalesce(localized_1.name, L_0.name) AS name,
  coalesce(localized_1.descr, L_0.descr) AS descr,
  L_0.code,
  L_0.symbol,
  L_0.minorUnit
FROM (sap_common_Currencies AS L_0 LEFT JOIN sap_common_Currencies_texts AS localized_1 ON localized_1.code = L_0.code AND localized_1.locale = session_context( '$user.locale' ));
```

✅ Created `srv/admin-service.cds` with projections and restock action, enabling draft mode for Fiori UI ⟶ done, looks decent too but I still need to implement the restock logic.

✅ Added sample CSV data for Products, Suppliers, and Stock ⟶ I think I already folllowed the best practice, each data field has matched the schema and the associations are correct. But seems I have issue for table names, so the CDS service expects `AdminService_` prefix. I thought it should be `com_nadsportfolio_inventory_` with the namespace as the prefix as it is what the generated SQL shows. I'm still figuring out how to fix this automatically instead of manually renaming the tables in the database.

## Next Steps

⬜ Fix table name mismatch. The issue is not with the data or schema but with how the `AdminService` queries the database.

⬜ Implement the restock action logic in `admin-service.js` to handle stock updates.
